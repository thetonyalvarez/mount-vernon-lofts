# Mount Vernon Lofts - Canonical URL and Redirect Rules
# Backup Apache configuration (primary handling in Next.js middleware)

# Enable mod_rewrite
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www subdomain - canonical preference for mtvernonlofts.com
RewriteCond %{HTTP_HOST} ^www\.mtvernonlofts\.com$ [NC]
RewriteRule ^(.*)$ https://mtvernonlofts.com/$1 [R=301,L]

# Handle index parameter that causes 404s in Search Console
RewriteCond %{QUERY_STRING} ^(.*)index=([^&]+)(.*)$ [NC]
RewriteRule ^(.*)$ /$1? [R=301,L]

# Remove tracking parameters to prevent duplicate content
RewriteCond %{QUERY_STRING} ^(.*)(?:&|^)(?:fbclid|gclid|utm_source|utm_medium|utm_campaign|utm_term|utm_content|ref|source)=([^&]+)(.*)$ [NC]
RewriteRule ^(.*)$ /$1? [R=301,L]

# Set canonical headers
Header always set Link '<https://mtvernonlofts.com>; rel="canonical"'

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options SAMEORIGIN
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "origin-when-cross-origin"

# Cache control for real estate assets
<FilesMatch "\.(jpg|jpeg|png|webp|avif|svg|gif|ico|mp4|webm|woff|woff2|ttf|eot|css|js)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    ExpiresActive On
    ExpiresDefault "access plus 1 year"
</FilesMatch>

# Handle HTML files with shorter cache
<FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, max-age=3600"
    ExpiresActive On
    ExpiresDefault "access plus 1 hour"
</FilesMatch>

# Prevent access to sensitive files
<Files ~ "\.(env|log|md)$">
    Order allow,deny
    Deny from all
</Files>

# Prevent directory browsing
Options -Indexes

# Custom error pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html